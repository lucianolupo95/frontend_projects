<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Maker - Torneo de Eliminaci√≥n</title>

    <!-- Favicon embebido en base64 (icono de trofeo) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM4YjVjZjYiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM2MzY2ZjEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0idXJsKCNnKSIvPjxwYXRoIGQ9Ik0zMCAyNWg0MHY1YzAgMTUtNSAyNS0yMCAzMC0xNS01LTIwLTE1LTIwLTMwdi01eiIgZmlsbD0iI2ZmZDcwMCIvPjxwYXRoIGQ9Ik0yNSAyNWgtNWMwIDEwIDUgMTUgMTAgMTV2LTEwYy01IDAtNS01LTUtNXoiIGZpbGw9IiNmZmQ3MDAiLz48cGF0aCBkPSJNNzUgMjVoNWMwIDEwLTUgMTUtMTAgMTV2LTEwYzUgMCA1LTUgNS01eiIgZmlsbD0iI2ZmZDcwMCIvPjxyZWN0IHg9IjQwIiB5PSI2MCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjgiIGZpbGw9IiNmZmQ3MDAiLz48cmVjdCB4PSIzNSIgeT0iNjgiIHdpZHRoPSIzMCIgaGVpZ2h0PSI4IiByeD0iMiIgZmlsbD0iI2ZmZDcwMCIvPjwvc3ZnPg==">

    <style>
        /* ===== VARIABLES CSS ===== */
        :root {
            /* Tema oscuro (por defecto) */
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252542;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b5;
            --accent-primary: #8b5cf6;
            --accent-secondary: #6366f1;
            --accent-hover: #a78bfa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border-color: #3a3a5c;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            --transition: all 0.3s ease;
        }

        [data-theme="light"] {
            --bg-primary: #f5f5fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8f0;
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a7a;
            --accent-primary: #7c3aed;
            --accent-secondary: #4f46e5;
            --accent-hover: #6d28d9;
            --border-color: #d0d0e0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* ===== RESET Y BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: var(--transition);
            line-height: 1.6;
        }

        /* ===== CONTENEDOR PRINCIPAL ===== */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER ===== */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
        }

        h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        /* ===== BOTONES ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-hover), var(--accent-primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-icon {
            padding: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== SELECTOR DE IDIOMA ===== */
        .lang-selector {
            display: flex;
            gap: 5px;
        }

        .lang-btn {
            padding: 6px 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .lang-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .lang-btn:hover:not(.active) {
            background: var(--border-color);
        }

        /* ===== BARRA DE PROGRESO ===== */
        .progress-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .progress-bar-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            height: 24px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-primary);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* ===== SECCI√ìN DE ENTRADA ===== */
        .input-section {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .input-section h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        textarea::placeholder {
            color: var(--text-secondary);
        }

        .input-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .options-count {
            margin-top: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ===== SECCI√ìN DEL TORNEO ===== */
        .tournament-section {
            display: none;
        }

        .tournament-section.active {
            display: block;
        }

        /* ===== MATCH ACTUAL ===== */
        .current-match {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .round-info {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .match-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: stretch;
            flex-wrap: wrap;
        }

        .option-card {
            flex: 1;
            min-width: 200px;
            max-width: 350px;
            padding: 30px 20px;
            background: var(--bg-tertiary);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            word-break: break-word;
        }

        .option-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .option-card:active {
            transform: translateY(-2px);
        }

        .vs-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .keyboard-hint {
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .match-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* ===== VISUALIZACI√ìN DEL BRACKET ===== */
        .bracket-section {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .bracket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .bracket-header h2 {
            font-size: 1.2rem;
        }

        .bracket-container {
            display: flex;
            gap: 40px;
            padding: 20px 0;
            min-width: max-content;
        }

        .bracket-round {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: space-around;
        }

        .round-title {
            text-align: center;
            color: var(--accent-primary);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .bracket-match {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 10px;
            min-width: 150px;
            border: 2px solid var(--border-color);
        }

        .bracket-match.current {
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }

        .bracket-participant {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 4px 0;
            font-size: 0.85rem;
            background: var(--bg-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }

        .bracket-participant.winner {
            background: var(--success);
            color: white;
        }

        .bracket-participant.loser {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .bracket-participant.bye {
            font-style: italic;
            color: var(--text-secondary);
        }

        .bracket-participant.pending {
            color: var(--text-secondary);
            font-style: italic;
        }

        /* ===== HISTORIAL ===== */
        .history-section {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: none;
        }

        .history-section.visible {
            display: block;
        }

        .history-section h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .history-number {
            background: var(--accent-primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .history-winner {
            color: var(--success);
            font-weight: 500;
        }

        .history-vs {
            color: var(--text-secondary);
        }

        .history-loser {
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        /* ===== GANADOR FINAL ===== */
        .winner-section {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .winner-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .winner-trophy {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .winner-title {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .winner-name {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            word-break: break-word;
        }

        /* ===== FOOTER ===== */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .progress-stats {
                justify-content: center;
            }

            .match-container {
                flex-direction: column;
            }

            .option-card {
                max-width: 100%;
            }

            .vs-separator {
                transform: rotate(90deg);
            }

            h1 {
                font-size: 1.2rem;
            }
        }

        /* ===== ANIMACIONES ===== */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== SCROLLBAR PERSONALIZADA ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 100 100">
                    <defs>
                        <linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#8b5cf6"/>
                            <stop offset="100%" stop-color="#6366f1"/>
                        </linearGradient>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="url(#g)"/>
                    <path d="M30 25h40v5c0 15-5 25-20 30-15-5-20-15-20-30v-5z" fill="#ffd700"/>
                    <path d="M25 25h-5c0 10 5 15 10 15v-10c-5 0-5-5-5-5z" fill="#ffd700"/>
                    <path d="M75 25h5c0 10-5 15-10 15v-10c5 0 5-5 5-5z" fill="#ffd700"/>
                    <rect x="40" y="60" width="20" height="8" fill="#ffd700"/>
                    <rect x="35" y="68" width="30" height="8" rx="2" fill="#ffd700"/>
                </svg>
                <h1 data-i18n="title">Decision Maker</h1>
            </div>
            <div class="header-controls">
                <!-- Selector de idioma -->
                <div class="lang-selector">
                    <button class="lang-btn active" data-lang="es">ES</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="ja">Êó•Êú¨Ë™û</button>
                </div>
                <!-- Toggle tema -->
                <button class="btn btn-secondary btn-icon" id="theme-toggle" title="Cambiar tema">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- BARRA DE PROGRESO -->
        <section class="progress-section" id="progress-section" style="display: none;">
            <div class="progress-stats">
                <div class="stat">
                    <div class="stat-value" id="total-comparisons">0</div>
                    <div class="stat-label" data-i18n="totalComparisons">Comparaciones totales</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="completed-comparisons">0</div>
                    <div class="stat-label" data-i18n="completedComparisons">Realizadas</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="remaining-comparisons">0</div>
                    <div class="stat-label" data-i18n="remainingComparisons">Restantes</div>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                <span class="progress-text" id="progress-text">0%</span>
            </div>
        </section>

        <!-- SECCI√ìN DE ENTRADA -->
        <section class="input-section" id="input-section">
            <h2 data-i18n="enterOptions">Ingresa las opciones</h2>
            <textarea
                id="options-input"
                data-i18n-placeholder="optionsPlaceholder"
                placeholder="Pega tus opciones aqu√≠ (una por l√≠nea)..."></textarea>
            <div class="options-count" id="options-count"></div>
            <div class="input-actions">
                <button class="btn btn-primary" id="start-btn" data-i18n="startTournament">
                    Iniciar Torneo
                </button>
            </div>
        </section>

        <!-- SECCI√ìN DEL TORNEO -->
        <section class="tournament-section" id="tournament-section">
            <!-- Match actual -->
            <div class="current-match" id="current-match">
                <div class="round-info" id="round-info"></div>
                <div class="match-container" id="match-container">
                    <div class="option-card" id="option-a"></div>
                    <div class="vs-separator">VS</div>
                    <div class="option-card" id="option-b"></div>
                </div>
                <div class="keyboard-hint" data-i18n="keyboardHint">
                    Atajo: ‚Üê o 1 | ‚Üí o 2
                </div>
                <div class="match-actions">
                    <button class="btn btn-secondary btn-small" id="undo-btn" data-i18n="undo" disabled>
                        ‚Ü© Deshacer
                    </button>
                    <button class="btn btn-secondary btn-small" id="toggle-history-btn" data-i18n="showHistory">
                        Mostrar historial
                    </button>
                    <button class="btn btn-danger btn-small" id="reset-btn" data-i18n="reset">
                        Resetear
                    </button>
                </div>
            </div>

            <!-- Bracket visual -->
            <div class="bracket-section">
                <div class="bracket-header">
                    <h2 data-i18n="bracket">Bracket del torneo</h2>
                </div>
                <div class="bracket-container" id="bracket-container"></div>
            </div>

            <!-- Historial -->
            <div class="history-section" id="history-section">
                <h2 data-i18n="history">Historial de decisiones</h2>
                <div class="history-list" id="history-list"></div>
            </div>
        </section>

        <!-- GANADOR FINAL -->
        <section class="winner-section" id="winner-section">
            <div class="winner-trophy">üèÜ</div>
            <div class="winner-title" data-i18n="winner">¬°Tenemos un ganador!</div>
            <div class="winner-name" id="winner-name"></div>
            <button class="btn btn-primary" id="new-tournament-btn" data-i18n="newTournament">
                Nuevo Torneo
            </button>
        </section>

        <!-- FOOTER -->
        <footer>
            <p data-i18n="footer">Decision Maker - Torneo de Eliminaci√≥n Directa</p>
        </footer>
    </div>

    <script>
        // ===== SISTEMA DE INTERNACIONALIZACI√ìN (i18n) =====
        const translations = {
            es: {
                title: "Decision Maker",
                enterOptions: "Ingresa las opciones",
                optionsPlaceholder: "Pega tus opciones aqu√≠ (una por l√≠nea)...",
                startTournament: "Iniciar Torneo",
                totalComparisons: "Comparaciones totales",
                completedComparisons: "Realizadas",
                remainingComparisons: "Restantes",
                round: "Ronda",
                finalRound: "Final",
                semifinal: "Semifinal",
                quarterfinal: "Cuartos de final",
                match: "Enfrentamiento",
                of: "de",
                undo: "‚Ü© Deshacer",
                showHistory: "Mostrar historial",
                hideHistory: "Ocultar historial",
                reset: "Resetear",
                bracket: "Bracket del torneo",
                history: "Historial de decisiones",
                winner: "¬°Tenemos un ganador!",
                newTournament: "Nuevo Torneo",
                footer: "Decision Maker - Torneo de Eliminaci√≥n Directa",
                bye: "(BYE)",
                pending: "Pendiente",
                vs: "derrot√≥ a",
                minOptionsError: "Necesitas al menos 2 opciones para iniciar el torneo.",
                optionsCount: "opciones v√°lidas",
                confirmReset: "¬øEst√°s seguro de que quieres resetear el torneo? Se perder√° todo el progreso.",
                keyboardHint: "Atajo: ‚Üê o 1 | ‚Üí o 2"
            },
            en: {
                title: "Decision Maker",
                enterOptions: "Enter your options",
                optionsPlaceholder: "Paste your options here (one per line)...",
                startTournament: "Start Tournament",
                totalComparisons: "Total comparisons",
                completedComparisons: "Completed",
                remainingComparisons: "Remaining",
                round: "Round",
                finalRound: "Final",
                semifinal: "Semifinal",
                quarterfinal: "Quarterfinal",
                match: "Match",
                of: "of",
                undo: "‚Ü© Undo",
                showHistory: "Show history",
                hideHistory: "Hide history",
                reset: "Reset",
                bracket: "Tournament bracket",
                history: "Decision history",
                winner: "We have a winner!",
                newTournament: "New Tournament",
                footer: "Decision Maker - Single Elimination Tournament",
                bye: "(BYE)",
                pending: "Pending",
                vs: "defeated",
                minOptionsError: "You need at least 2 options to start the tournament.",
                optionsCount: "valid options",
                confirmReset: "Are you sure you want to reset the tournament? All progress will be lost.",
                keyboardHint: "Shortcut: ‚Üê or 1 | ‚Üí or 2"
            },
            ja: {
                title: "„Éá„Ç∑„Ç∏„Éß„É≥„É°„Éº„Ç´„Éº",
                enterOptions: "„Ç™„Éó„Ç∑„Éß„É≥„ÇíÂÖ•Âäõ",
                optionsPlaceholder: "„Ç™„Éó„Ç∑„Éß„É≥„Çí„Åì„Åì„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºà1Ë°å„Å´1„Å§Ôºâ...",
                startTournament: "„Éà„Éº„Éä„É°„É≥„ÉàÈñãÂßã",
                totalComparisons: "Á∑èÊØîËºÉÊï∞",
                completedComparisons: "ÂÆå‰∫Ü",
                remainingComparisons: "ÊÆã„Çä",
                round: "„É©„Ç¶„É≥„Éâ",
                finalRound: "Ê±∫Âãù",
                semifinal: "Ê∫ñÊ±∫Âãù",
                quarterfinal: "Ê∫ñ„ÄÖÊ±∫Âãù",
                match: "ÂØæÊà¶",
                of: "/",
                undo: "‚Ü© ÂÖÉ„Å´Êàª„Åô",
                showHistory: "Â±•Ê≠¥„ÇíË°®Á§∫",
                hideHistory: "Â±•Ê≠¥„ÇíÈö†„Åô",
                reset: "„É™„Çª„ÉÉ„Éà",
                bracket: "„Éà„Éº„Éä„É°„É≥„ÉàË°®",
                history: "Ê±∫ÂÆöÂ±•Ê≠¥",
                winner: "ÂãùËÄÖÊ±∫ÂÆöÔºÅ",
                newTournament: "Êñ∞„Åó„ÅÑ„Éà„Éº„Éä„É°„É≥„Éà",
                footer: "„Éá„Ç∑„Ç∏„Éß„É≥„É°„Éº„Ç´„Éº - „Ç∑„É≥„Ç∞„É´„Ç®„É™„Éü„Éç„Éº„Ç∑„Éß„É≥",
                bye: "(‰∏çÊà¶Âãù)",
                pending: "Êú™ÂÆö",
                vs: "„ÅåÂãùÂà©",
                minOptionsError: "„Éà„Éº„Éä„É°„É≥„Éà„ÇíÈñãÂßã„Åô„Çã„Å´„ÅØ„ÄÅÂ∞ë„Å™„Åè„Å®„ÇÇ2„Å§„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ",
                optionsCount: "ÊúâÂäπ„Å™„Ç™„Éó„Ç∑„Éß„É≥",
                confirmReset: "„Éà„Éº„Éä„É°„É≥„Éà„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü„Åô„Åπ„Å¶„ÅÆÈÄ≤Ë°åÁä∂Ê≥Å„ÅåÂ§±„Çè„Çå„Åæ„Åô„ÄÇ",
                keyboardHint: "„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà: ‚Üê „Åã 1 | ‚Üí „Åã 2"
            }
        };

        let currentLang = 'es';

        /**
         * Traduce un texto seg√∫n el idioma actual
         * @param {string} key - Clave de traducci√≥n
         * @returns {string} - Texto traducido
         */
        function t(key) {
            return translations[currentLang][key] || translations['es'][key] || key;
        }

        /**
         * Aplica las traducciones a todos los elementos con data-i18n
         */
        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });

            // Actualizar t√≠tulo de la p√°gina
            document.title = t('title') + ' - ' + t('footer').split(' - ')[1];

            // Actualizar conteo de opciones si hay
            updateOptionsCount();

            // Actualizar info de ronda si el torneo est√° activo
            if (tournament && tournament.active) {
                updateRoundInfo();
            }
        }

        /**
         * Cambia el idioma de la aplicaci√≥n
         * @param {string} lang - C√≥digo del idioma (es, en, ja)
         */
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('dm_language', lang);

            // Actualizar botones de idioma
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            applyTranslations();

            // Actualizar bot√≥n de historial
            const historySection = document.getElementById('history-section');
            const toggleBtn = document.getElementById('toggle-history-btn');
            if (historySection.classList.contains('visible')) {
                toggleBtn.textContent = t('hideHistory');
            } else {
                toggleBtn.textContent = t('showHistory');
            }
        }

        // ===== GESTI√ìN DEL TEMA =====

        /**
         * Alterna entre tema claro y oscuro
         */
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('dm_theme', newTheme);
            updateThemeIcon(newTheme);
        }

        /**
         * Actualiza el icono del bot√≥n de tema
         * @param {string} theme - Tema actual
         */
        function updateThemeIcon(theme) {
            const themeToggle = document.getElementById('theme-toggle');
            if (theme === 'light') {
                themeToggle.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                `;
            } else {
                themeToggle.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                `;
            }
        }

        // ===== ESTADO DEL TORNEO =====

        let tournament = {
            active: false,
            options: [],           // Opciones originales
            rounds: [],            // Estructura del bracket completo
            currentRound: 0,       // Ronda actual (0-indexed)
            currentMatch: 0,       // Match actual dentro de la ronda
            history: [],           // Historial de decisiones para deshacer
            totalComparisons: 0,   // Total de comparaciones necesarias
            completedComparisons: 0 // Comparaciones realizadas
        };

        // ===== FUNCIONES UTILITARIAS =====

        /**
         * Baraja un array usando el algoritmo Fisher-Yates
         * @param {Array} array - Array a barajar
         * @returns {Array} - Array barajado
         */
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        /**
         * Calcula el n√∫mero total de comparaciones para n participantes
         * @param {number} n - N√∫mero de participantes
         * @returns {number} - N√∫mero de comparaciones
         */
        function calculateTotalComparisons(n) {
            // En eliminaci√≥n directa, siempre hay n-1 partidos
            return n - 1;
        }

        /**
         * Parsea las opciones del textarea
         * @returns {Array} - Array de opciones √∫nicas y no vac√≠as
         */
        function parseOptions() {
            const input = document.getElementById('options-input').value;
            const lines = input.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);

            // Eliminar duplicados manteniendo el orden
            return [...new Set(lines)];
        }

        /**
         * Actualiza el contador de opciones
         */
        function updateOptionsCount() {
            const options = parseOptions();
            const countEl = document.getElementById('options-count');
            if (options.length > 0) {
                countEl.textContent = `${options.length} ${t('optionsCount')}`;
            } else {
                countEl.textContent = '';
            }
        }

        // ===== L√ìGICA DEL TORNEO =====

        /**
         * Inicializa el bracket del torneo
         * @param {Array} options - Opciones para el torneo
         */
        function initializeBracket(options) {
            // Barajar opciones
            const shuffled = shuffle(options);

            // Calcular estructura del bracket
            const rounds = [];
            let participants = shuffled.map(opt => ({ name: opt, status: 'pending' }));

            // Primera ronda
            const firstRound = [];
            for (let i = 0; i < participants.length; i += 2) {
                const match = {
                    participant1: participants[i],
                    participant2: participants[i + 1] || null, // null = bye
                    winner: null,
                    isBye: !participants[i + 1]
                };
                firstRound.push(match);
            }
            rounds.push(firstRound);

            // Calcular rondas siguientes (vac√≠as por ahora)
            let matchCount = Math.ceil(firstRound.length / 2);
            while (matchCount >= 1) {
                const round = [];
                for (let i = 0; i < matchCount; i++) {
                    round.push({
                        participant1: null,
                        participant2: null,
                        winner: null,
                        isBye: false
                    });
                }
                rounds.push(round);
                if (matchCount === 1) break;
                matchCount = Math.ceil(matchCount / 2);
            }

            return rounds;
        }

        /**
         * Procesa los byes autom√°ticamente
         * Un bye ocurre cuando:
         * 1. match.isBye es true (primera ronda con n√∫mero impar)
         * 2. Solo hay un participante definido y el otro nunca llegar√°
         */
        function processByes() {
            const currentRoundMatches = tournament.rounds[tournament.currentRound];
            if (!currentRoundMatches) return;

            while (tournament.currentMatch < currentRoundMatches.length) {
                const match = currentRoundMatches[tournament.currentMatch];

                // Caso 1: Bye expl√≠cito de primera ronda
                if (match.isBye && !match.winner && match.participant1) {
                    match.winner = match.participant1;
                    match.participant1.status = 'winner';
                    advanceWinner(match.winner);
                    tournament.currentMatch++;
                    continue;
                }

                // Caso 2: Verificar si es un bye din√°mico en rondas posteriores
                // Esto ocurre cuando solo un participante puede llegar al match
                if (!match.winner && tournament.currentRound > 0) {
                    const prevRound = tournament.rounds[tournament.currentRound - 1];
                    const sourceMatch1Index = tournament.currentMatch * 2;
                    const sourceMatch2Index = tournament.currentMatch * 2 + 1;

                    const sourceMatch1 = prevRound[sourceMatch1Index];
                    const sourceMatch2 = prevRound[sourceMatch2Index];

                    // Si el segundo match fuente no existe, es un bye
                    if (!sourceMatch2 && sourceMatch1 && sourceMatch1.winner) {
                        match.participant1 = { name: sourceMatch1.winner.name, status: 'pending' };
                        match.participant2 = null;
                        match.isBye = true;
                        match.winner = match.participant1;
                        match.participant1.status = 'winner';
                        advanceWinner(match.winner);
                        tournament.currentMatch++;
                        continue;
                    }
                }

                // Si llegamos aqu√≠ y el match no est√° listo, salir del loop
                break;
            }

            // Si terminamos la ronda, pasar a la siguiente
            if (tournament.currentMatch >= currentRoundMatches.length) {
                if (tournament.currentRound < tournament.rounds.length - 1) {
                    tournament.currentRound++;
                    tournament.currentMatch = 0;
                    processByes(); // Procesar byes de la nueva ronda
                }
            }
        }

        /**
         * Avanza al ganador a la siguiente ronda
         * @param {Object} winner - Participante ganador
         */
        function advanceWinner(winner) {
            const nextRound = tournament.currentRound + 1;
            if (nextRound >= tournament.rounds.length) return;

            const nextMatchIndex = Math.floor(tournament.currentMatch / 2);
            const nextRoundMatches = tournament.rounds[nextRound];

            if (!nextRoundMatches || nextMatchIndex >= nextRoundMatches.length) return;

            const nextMatch = nextRoundMatches[nextMatchIndex];
            if (!nextMatch) return;

            // Determinar si es participante 1 o 2 en el siguiente match
            if (tournament.currentMatch % 2 === 0) {
                nextMatch.participant1 = { name: winner.name, status: 'pending' };
            } else {
                nextMatch.participant2 = { name: winner.name, status: 'pending' };
            }
        }

        /**
         * Inicia el torneo con las opciones proporcionadas
         */
        function startTournament() {
            const options = parseOptions();

            if (options.length < 2) {
                alert(t('minOptionsError'));
                return;
            }

            // Inicializar estado del torneo
            tournament = {
                active: true,
                options: options,
                rounds: initializeBracket(options),
                currentRound: 0,
                currentMatch: 0,
                history: [],
                totalComparisons: calculateTotalComparisons(options.length),
                completedComparisons: 0
            };

            // Procesar byes iniciales
            processByes();

            // Guardar estado
            saveTournamentState();

            // Actualizar UI
            showTournamentUI();
            updateUI();
        }

        /**
         * Muestra la interfaz del torneo
         */
        function showTournamentUI() {
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('tournament-section').classList.add('active');
            document.getElementById('winner-section').classList.remove('active');
        }

        /**
         * Muestra la interfaz de entrada
         */
        function showInputUI() {
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('tournament-section').classList.remove('active');
            document.getElementById('winner-section').classList.remove('active');
            document.getElementById('history-section').classList.remove('visible');
        }

        /**
         * Actualiza toda la interfaz
         */
        function updateUI() {
            updateProgress();
            updateCurrentMatch();
            updateBracketVisualization();
            updateHistoryList();
            updateUndoButton();
        }

        /**
         * Actualiza la barra de progreso y estad√≠sticas
         */
        function updateProgress() {
            const total = tournament.totalComparisons;
            const completed = tournament.completedComparisons;
            const remaining = total - completed;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('total-comparisons').textContent = total;
            document.getElementById('completed-comparisons').textContent = completed;
            document.getElementById('remaining-comparisons').textContent = remaining;
            document.getElementById('progress-bar').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${percentage}%`;
        }

        /**
         * Actualiza la visualizaci√≥n del match actual
         */
        function updateCurrentMatch() {
            // Verificar que el torneo est√© activo
            if (!tournament.active || !tournament.rounds.length) return;

            // Verificar si el torneo termin√≥
            if (checkTournamentEnd()) {
                return;
            }

            const currentRoundMatches = tournament.rounds[tournament.currentRound];
            if (!currentRoundMatches) return;

            const match = currentRoundMatches[tournament.currentMatch];

            if (!match || !match.participant1 || !match.participant2) {
                // Esperar a que se llenen los participantes
                return;
            }

            document.getElementById('option-a').textContent = match.participant1.name;
            document.getElementById('option-b').textContent = match.participant2.name;

            updateRoundInfo();
        }

        /**
         * Actualiza la informaci√≥n de la ronda
         */
        function updateRoundInfo() {
            if (!tournament.rounds.length) return;

            const totalRounds = tournament.rounds.length;
            const currentRound = tournament.currentRound + 1;
            const currentRoundMatches = tournament.rounds[tournament.currentRound];
            if (!currentRoundMatches) return;

            const matchesInRound = currentRoundMatches.length;
            const currentMatch = tournament.currentMatch + 1;

            let roundName;
            const remainingRounds = totalRounds - tournament.currentRound;

            if (remainingRounds === 1) {
                roundName = t('finalRound');
            } else if (remainingRounds === 2) {
                roundName = t('semifinal');
            } else if (remainingRounds === 3) {
                roundName = t('quarterfinal');
            } else {
                roundName = `${t('round')} ${currentRound}`;
            }

            document.getElementById('round-info').textContent =
                `${roundName} - ${t('match')} ${currentMatch} ${t('of')} ${matchesInRound}`;
        }

        /**
         * Maneja la selecci√≥n de una opci√≥n
         * @param {number} optionIndex - 0 para opci√≥n A, 1 para opci√≥n B
         */
        function selectOption(optionIndex) {
            // Verificar que el torneo est√© activo
            if (!tournament.active || !tournament.rounds.length) return;

            const currentRoundMatches = tournament.rounds[tournament.currentRound];
            if (!currentRoundMatches) return;

            const match = currentRoundMatches[tournament.currentMatch];

            // Verificar que el match existe, no tiene ganador, y ambos participantes est√°n definidos
            if (!match || match.winner || !match.participant1 || !match.participant2) return;

            const winner = optionIndex === 0 ? match.participant1 : match.participant2;
            const loser = optionIndex === 0 ? match.participant2 : match.participant1;

            // Guardar en historial para deshacer
            tournament.history.push({
                round: tournament.currentRound,
                match: tournament.currentMatch,
                winner: winner.name,
                loser: loser.name
            });

            // Marcar ganador y perdedor
            match.winner = winner;
            winner.status = 'winner';
            loser.status = 'loser';

            // Avanzar ganador
            advanceWinner(winner);

            // Incrementar comparaciones
            tournament.completedComparisons++;

            // Siguiente match
            tournament.currentMatch++;

            // Verificar si termin√≥ la ronda
            if (tournament.currentMatch >= currentRoundMatches.length) {
                if (tournament.currentRound < tournament.rounds.length - 1) {
                    tournament.currentRound++;
                    tournament.currentMatch = 0;
                    processByes();
                }
            } else {
                processByes();
            }

            // Guardar y actualizar
            saveTournamentState();
            updateUI();
        }

        /**
         * Verifica si el torneo ha terminado
         * @returns {boolean} - true si el torneo termin√≥
         */
        function checkTournamentEnd() {
            const finalRound = tournament.rounds[tournament.rounds.length - 1];
            const finalMatch = finalRound[0];

            if (finalMatch && finalMatch.winner) {
                showWinner(finalMatch.winner.name);
                return true;
            }

            return false;
        }

        /**
         * Muestra al ganador final
         * @param {string} winnerName - Nombre del ganador
         */
        function showWinner(winnerName) {
            document.getElementById('current-match').style.display = 'none';
            document.getElementById('winner-section').classList.add('active');
            document.getElementById('winner-name').textContent = winnerName;
        }

        /**
         * Deshace la √∫ltima elecci√≥n
         */
        function undoLastChoice() {
            if (tournament.history.length === 0) return;

            const lastAction = tournament.history.pop();

            // Restaurar el estado del match
            const match = tournament.rounds[lastAction.round][lastAction.match];
            match.winner = null;
            match.participant1.status = 'pending';
            match.participant2.status = 'pending';

            // Limpiar la siguiente ronda
            const nextRound = lastAction.round + 1;
            if (nextRound < tournament.rounds.length) {
                const nextMatchIndex = Math.floor(lastAction.match / 2);
                const nextMatch = tournament.rounds[nextRound][nextMatchIndex];

                if (lastAction.match % 2 === 0) {
                    nextMatch.participant1 = null;
                } else {
                    nextMatch.participant2 = null;
                }
                nextMatch.winner = null;
            }

            // Restaurar posici√≥n
            tournament.currentRound = lastAction.round;
            tournament.currentMatch = lastAction.match;
            tournament.completedComparisons--;

            // Ocultar secci√≥n de ganador si estaba visible
            document.getElementById('winner-section').classList.remove('active');
            document.getElementById('current-match').style.display = 'block';

            // Guardar y actualizar
            saveTournamentState();
            updateUI();
        }

        /**
         * Actualiza el bot√≥n de deshacer
         */
        function updateUndoButton() {
            const undoBtn = document.getElementById('undo-btn');
            undoBtn.disabled = tournament.history.length === 0;
        }

        /**
         * Resetea el torneo
         */
        function resetTournament() {
            if (!confirm(t('confirmReset'))) return;

            localStorage.removeItem('dm_tournament');
            tournament = {
                active: false,
                options: [],
                rounds: [],
                currentRound: 0,
                currentMatch: 0,
                history: [],
                totalComparisons: 0,
                completedComparisons: 0
            };

            document.getElementById('options-input').value = '';
            document.getElementById('current-match').style.display = 'block';
            showInputUI();
        }

        // ===== VISUALIZACI√ìN DEL BRACKET =====

        /**
         * Actualiza la visualizaci√≥n del bracket completo
         */
        function updateBracketVisualization() {
            const container = document.getElementById('bracket-container');
            container.innerHTML = '';

            tournament.rounds.forEach((round, roundIndex) => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'bracket-round';

                // T√≠tulo de la ronda
                const title = document.createElement('div');
                title.className = 'round-title';

                const remainingRounds = tournament.rounds.length - roundIndex;
                if (remainingRounds === 1) {
                    title.textContent = t('finalRound');
                } else if (remainingRounds === 2) {
                    title.textContent = t('semifinal');
                } else if (remainingRounds === 3) {
                    title.textContent = t('quarterfinal');
                } else {
                    title.textContent = `${t('round')} ${roundIndex + 1}`;
                }

                roundDiv.appendChild(title);

                // Matches de la ronda
                round.forEach((match, matchIndex) => {
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'bracket-match';

                    // Marcar match actual
                    if (roundIndex === tournament.currentRound &&
                        matchIndex === tournament.currentMatch &&
                        !checkIfTournamentEnded()) {
                        matchDiv.classList.add('current');
                    }

                    // Participante 1
                    const p1 = document.createElement('div');
                    p1.className = 'bracket-participant';
                    if (match.participant1) {
                        p1.textContent = match.participant1.name;
                        if (match.winner) {
                            p1.classList.add(match.winner.name === match.participant1.name ? 'winner' : 'loser');
                        }
                    } else {
                        p1.textContent = t('pending');
                        p1.classList.add('pending');
                    }
                    matchDiv.appendChild(p1);

                    // Participante 2
                    const p2 = document.createElement('div');
                    p2.className = 'bracket-participant';
                    if (match.isBye) {
                        p2.textContent = t('bye');
                        p2.classList.add('bye');
                    } else if (match.participant2) {
                        p2.textContent = match.participant2.name;
                        if (match.winner) {
                            p2.classList.add(match.winner.name === match.participant2.name ? 'winner' : 'loser');
                        }
                    } else {
                        p2.textContent = t('pending');
                        p2.classList.add('pending');
                    }
                    matchDiv.appendChild(p2);

                    roundDiv.appendChild(matchDiv);
                });

                container.appendChild(roundDiv);
            });
        }

        /**
         * Verifica si el torneo ha terminado (sin mostrar ganador)
         */
        function checkIfTournamentEnded() {
            if (tournament.rounds.length === 0) return false;
            const finalRound = tournament.rounds[tournament.rounds.length - 1];
            return finalRound[0] && finalRound[0].winner;
        }

        // ===== HISTORIAL =====

        /**
         * Actualiza la lista de historial
         */
        function updateHistoryList() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            tournament.history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <span class="history-number">${index + 1}</span>
                    <span class="history-winner">${item.winner}</span>
                    <span class="history-vs">${t('vs')}</span>
                    <span class="history-loser">${item.loser}</span>
                `;
                historyList.appendChild(div);
            });
        }

        /**
         * Alterna la visibilidad del historial
         */
        function toggleHistory() {
            const historySection = document.getElementById('history-section');
            const toggleBtn = document.getElementById('toggle-history-btn');

            historySection.classList.toggle('visible');

            if (historySection.classList.contains('visible')) {
                toggleBtn.textContent = t('hideHistory');
            } else {
                toggleBtn.textContent = t('showHistory');
            }
        }

        // ===== PERSISTENCIA EN LOCALSTORAGE =====

        /**
         * Guarda el estado del torneo en localStorage
         */
        function saveTournamentState() {
            localStorage.setItem('dm_tournament', JSON.stringify(tournament));
        }

        /**
         * Carga el estado del torneo desde localStorage
         */
        function loadTournamentState() {
            const saved = localStorage.getItem('dm_tournament');
            if (saved) {
                try {
                    tournament = JSON.parse(saved);
                    if (tournament.active) {
                        showTournamentUI();
                        updateUI();
                    }
                } catch (e) {
                    console.error('Error loading tournament state:', e);
                }
            }
        }

        /**
         * Carga las preferencias del usuario
         */
        function loadPreferences() {
            // Cargar tema
            const savedTheme = localStorage.getItem('dm_theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // Cargar idioma
            const savedLang = localStorage.getItem('dm_language') || 'es';
            setLanguage(savedLang);
        }

        // ===== INICIALIZACI√ìN Y EVENT LISTENERS =====

        document.addEventListener('DOMContentLoaded', () => {
            // Cargar preferencias y estado guardado
            loadPreferences();
            loadTournamentState();

            // Event listeners para botones de idioma
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
            });

            // Event listener para toggle de tema
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

            // Event listener para textarea
            document.getElementById('options-input').addEventListener('input', updateOptionsCount);

            // Event listener para iniciar torneo
            document.getElementById('start-btn').addEventListener('click', startTournament);

            // Event listeners para opciones (click)
            document.getElementById('option-a').addEventListener('click', () => selectOption(0));
            document.getElementById('option-b').addEventListener('click', () => selectOption(1));

            // Event listener para teclado (flechas y n√∫meros 1/2)
            document.addEventListener('keydown', (e) => {
                // Solo funciona si el torneo est√° activo y no estamos en el textarea
                if (!tournament.active || e.target.tagName === 'TEXTAREA') return;

                // Verificar que no haya terminado el torneo
                if (checkIfTournamentEnded()) return;

                switch (e.key) {
                    case 'ArrowLeft':
                    case '1':
                        e.preventDefault();
                        selectOption(0);
                        break;
                    case 'ArrowRight':
                    case '2':
                        e.preventDefault();
                        selectOption(1);
                        break;
                }
            });

            // Event listener para deshacer
            document.getElementById('undo-btn').addEventListener('click', undoLastChoice);

            // Event listener para toggle historial
            document.getElementById('toggle-history-btn').addEventListener('click', toggleHistory);

            // Event listener para resetear
            document.getElementById('reset-btn').addEventListener('click', resetTournament);

            // Event listener para nuevo torneo
            document.getElementById('new-tournament-btn').addEventListener('click', resetTournament);

            // Aplicar traducciones iniciales
            applyTranslations();
        });
    </script>
</body>
</html>
